{"mappings":"AAEA,0BAA0B,EACxB,UAA2B,GAC5B,GAAE;IAAE,UAAU,CAAC,EAAE,OAAO,IAAI,CAAA;CAAO,GAAG,OAAO,WAAW,CAyDxD","sources":["factory/factory/index.ts","factory/index.ts"],"sourcesContent":[null,"import type { CompartmentEvaluateOptions, CompartmentOptions } from \"ses\";\nimport { getGlobalIntrinsics } from \"../node_modules/ses/src/intrinsics.js\";\nexport function createRaw({\n  globalThis = eval?.(\"this\"),\n}: { globalThis?: typeof self } = {}): typeof Compartment {\n  return class _UniCompartment {\n    static readonly #evaluatorFactory: Function =\n      \"eval\" in globalThis\n        ? new Function(\"$\", `with($){return a=>eval(a);}`)\n        : ($: any) => {\n            throw ``;\n          };\n    #opts: CompartmentOptions;\n    constructor(opts: CompartmentOptions) {\n      this.#opts = opts;\n      const val = {\n        ...(() => {\n          if (\"Object\" in globalThis && \"freeze\" in globalThis[\"Object\"]) {\n            return getGlobalIntrinsics(globalThis, { ...console });\n          } else {\n            return {};\n          }\n        })(),\n        ...(opts.globals ?? {}),\n      };\n      if (\"Object\" in globalThis && \"freeze\" in globalThis[\"Object\"]) {\n        globalThis[\"Object\"][\"freeze\"](val);\n      }\n      this.#scope =\n        \"Proxy\" in globalThis\n          ? new globalThis[\"Proxy\"](val, {\n              has(target, p) {\n                return true;\n              },\n            })\n          : val;\n    }\n    #scope: any;\n    get globalThis() {\n      return this.#scope;\n    }\n    get name() {\n      return (this.#opts.name ??=\n        \"crypto\" in globalThis\n          ? globalThis.crypto.randomUUID()\n          : \"Math\" in globalThis\n          ? `${Math.random()}`\n          : \"unnamed\");\n    }\n    #_evaluator: ((a: string) => any) | undefined;\n    get #evaluator(): (a: string) => any {\n      return (this.#_evaluator ??= _UniCompartment.#evaluatorFactory.call(\n        this.#scope,\n        this.#scope\n      ));\n    }\n    evaluate(a: string, opts?: CompartmentEvaluateOptions): any {\n      a = this.#opts.transforms?.reduce?.((i, f) => f(i), a) ?? a;\n      return this.#evaluator(a);\n    }\n  } as any;\n}\n"],"names":[],"version":3,"file":"index.d.ts.map"}